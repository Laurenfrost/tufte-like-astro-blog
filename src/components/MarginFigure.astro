---
interface Props {
  id: string;
  src: string;
  alt: string;
  caption?: string;
}

const { id, src, alt, caption } = Astro.props;
---

<span class="marginfigure-wrapper">
  <label class="marginfigure-toggle-label" for={`mf-${id}`}>&#9633;</label>
  <input type="checkbox" id={`mf-${id}`} class="marginfigure-toggle" />
  <span class="marginfigure" role="figure">
    <img src={src} alt={alt} loading="lazy" />
    {caption && <span class="caption">{caption}</span>}
  </span>
</span>

<style>
  .marginfigure-wrapper {
    position: relative;
  }

  .marginfigure-toggle {
    display: none;
  }

  .marginfigure-toggle-label {
    display: none;
  }

  /* Desktop: figure floats into right padding area */
  @media (min-width: 768px) {
    .marginfigure {
      float: right;
      clear: right;
      position: relative;
      margin-right: -38%;
      width: 33%;
      margin-top: 0;
      margin-bottom: 0.25rem;
    }

    .marginfigure img {
      width: 100%;
      height: auto;
      display: block;
      margin: 0 !important;
    }

    .marginfigure .caption {
      display: block;
      font-size: 0.75rem;
      line-height: 1.4;
      color: #555;
      margin-top: 0.3rem;
    }
  }

  @media (min-width: 1024px) {
    .marginfigure {
      margin-right: -42%;
      width: 36%;
    }
  }

  /* Wide screens: fixed values */
  @media (min-width: 1400px) {
    .marginfigure {
      margin-right: -420px;
      width: 380px;
    }
  }

  /* Mobile: hidden by default, shown inline when clicked */
  @media (max-width: 767px) {
    .marginfigure-toggle-label {
      display: inline;
      cursor: pointer;
      color: #a00;
      font-size: 0.9em;
      margin-left: 0.2em;
    }

    .marginfigure {
      display: none;
    }

    .marginfigure-toggle:checked + .marginfigure {
      display: block;
      float: none;
      clear: both;
      width: 100%;
      margin: 0.8rem 0;
      padding: 0.5rem;
      background-color: #f8f8f5;
      border-radius: 4px;
    }

    .marginfigure-toggle:checked + .marginfigure img {
      width: 100%;
      height: auto;
      margin: 0 !important;
    }

    .marginfigure-toggle:checked + .marginfigure .caption {
      display: block;
      font-size: 0.85rem;
      color: #555;
      margin-top: 0.5rem;
    }
  }
</style>
